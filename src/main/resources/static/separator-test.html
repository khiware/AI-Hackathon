<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Separator Row Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 12px;
            border: 1px solid #e8e8e8;
        }
        tr:nth-child(even) td {
            background: #f9f9f9;
        }
        .test-box {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üß™ Separator Row Fix - Verification Test</h1>

    <div class="test-box">
        <h3>Test Input (JSON Response):</h3>
        <pre>{
  "answer": "Variable Pay is typically paid according to the following schedule:\n\n| Quarters | Payment Month |\n|---------------------|---------------|\n| April to June (Q1) | August |\n| July to September (Q2) | November |\n| October to December (Q3) | February |\n| January to March (Q4) | May |"
}</pre>
    </div>

    <h2>Rendered Output:</h2>
    <div id="output"></div>

    <div class="test-box">
        <h3>Test Results:</h3>
        <p id="result"></p>
    </div>

    <script>
        // Copy the fixed functions
        function formatMarkdownWithTables(text) {
            let html = '';
            const lines = text.split('\n');
            let inTable = false;
            let tableRows = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                if (line.includes('|') && line.split('|').filter(cell => cell.trim()).length > 1) {
                    if (!inTable) {
                        inTable = true;
                        tableRows = [];
                    }
                    tableRows.push(line);
                } else {
                    if (inTable) {
                        html += renderMarkdownTable(tableRows);
                        inTable = false;
                        tableRows = [];
                    }
                    if (line) {
                        let formattedLine = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                        html += formattedLine + '<br>';
                    } else {
                        html += '<br>';
                    }
                }
            }

            if (inTable && tableRows.length > 0) {
                html += renderMarkdownTable(tableRows);
            }

            return html;
        }

        function renderMarkdownTable(rows) {
            if (rows.length < 2) return rows.join('<br>');

            let html = '<table>';
            let headerProcessed = false;
            let separatorFound = false;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i].trim();

                // Skip separator rows
                const rowContent = row.replace(/\s/g, '');
                if (/^[\|:\-]+$/.test(rowContent)) {
                    separatorFound = true;
                    console.log('‚úÖ Separator row detected and skipped:', row);
                    continue;
                }

                const cells = row.split('|')
                    .map(cell => cell.trim())
                    .filter(cell => cell);

                if (cells.length === 0) continue;

                const isHeader = !headerProcessed;
                if (isHeader) headerProcessed = true;

                const tag = isHeader ? 'th' : 'td';

                html += '<tr>';
                cells.forEach(cell => {
                    let formattedCell = cell.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    html += `<${tag}>${formattedCell}</${tag}>`;
                });
                html += '</tr>';
            }

            html += '</table>';

            // Update result
            if (separatorFound) {
                document.getElementById('result').innerHTML = '<span class="success">‚úÖ SUCCESS: Separator row was detected and removed!</span>';
            } else {
                document.getElementById('result').innerHTML = '<span class="error">‚ùå FAILED: Separator row was not detected!</span>';
            }

            return html;
        }

        // Test data
        const testAnswer = `Variable Pay is typically paid according to the following schedule:

| Quarters            | Payment Month |
|---------------------|---------------|
| April to June (Q1)  | August        |
| July to September (Q2) | November    |
| October to December (Q3) | February  |
| January to March (Q4)   | May         |`;

        // Render the table
        document.getElementById('output').innerHTML = formatMarkdownWithTables(testAnswer);
    </script>
</body>
</html>

